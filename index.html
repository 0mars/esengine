<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Esengine by catholabs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Esengine</h1>
      <h2 class="project-tagline">ElasticSearch ODM (Object Document Mapper) for Python - pip install esengine</h2>
      <a href="https://github.com/catholabs/esengine" class="btn">View on GitHub</a>
      <a href="https://github.com/catholabs/esengine/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/catholabs/esengine/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p><img src="https://raw.githubusercontent.com/catholabs/esengine/master/octosearch.gif" align="left" width="192px" height="132px">
<img align="left" width="0" height="192px" hspace="10"></p>

<blockquote>
<p><strong>esengine</strong> - The <strong>E</strong>lastic<strong>s</strong>earch <strong>O</strong>bject <strong>D</strong>ocument <strong>M</strong>apper</p>
</blockquote>

<p><a href="https://pypi.python.org/pypi/esengine"><img src="https://img.shields.io/pypi/v/esengine.svg" alt="PyPI"></a>
<a href="https://pypi.python.org/pypi/esengine"><img src="https://img.shields.io/pypi/pyversions/esengine.svg" alt="versions"></a>
<a href="https://pypi.python.org/pypi/esengine"><img src="https://img.shields.io/pypi/dw/esengine.svg" alt="downloads"></a>
<a href="https://travis-ci.org/catholabs/esengine"><img src="http://img.shields.io/travis/catholabs/esengine.svg" alt="Travis CI"></a>
<a href="https://coveralls.io/r/catholabs/esengine"><img src="http://img.shields.io/coveralls/catholabs/esengine.svg" alt="Coverage Status"></a>
<a href="https://landscape.io/github/catholabs/esengine/master"><img src="https://landscape.io/github/catholabs/esengine/master/landscape.svg?style=flat" alt="Code Health"></a></p>

<p><strong>esengine</strong> is an ODM (<strong>O</strong>bject <strong>D</strong>ocument <strong>M</strong>apper) it maps Python classes in to <strong>E</strong>lastic<strong>s</strong>earch <strong>index/doc_type</strong> and <strong>object instances()</strong> in to Elasticsearch documents.</p>

<p><br><br></p>

<h3>
<a id="modeling" class="anchor" href="#modeling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Modeling</h3>

<p>Out of the box ESengine takes care only of the Modeling and CRUD operations including:</p>

<ul>
<li>Index, DocType and Mapping specification </li>
<li>Fields and its types coercion</li>
<li>basic CRUD operations (Create, Read, Update, Delete)</li>
</ul>

<h3>
<a id="communication" class="anchor" href="#communication" aria-hidden="true"><span class="octicon octicon-link"></span></a>Communication</h3>

<p>ESengine does not communicate directly with ElasticSearch, it only creates the basic structure, 
To communicate it relies on an ES client providing the transport methods (index, delete, update etc). </p>

<h3>
<a id="es-client" class="anchor" href="#es-client" aria-hidden="true"><span class="octicon octicon-link"></span></a>ES client</h3>

<p>ESengine does not enforce the use of the official ElasticSearch client,
but you are encouraged to use it because it is well maintained and has the support to <strong>bulk</strong> operations. But you are free to use another client or create your own (useful for tests).</p>

<h3>
<a id="querying-the-data" class="anchor" href="#querying-the-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Querying the data</h3>

<p>ESengine does not enforce or encourage you to use a DSL language for queries, out of the box you have to
write the elasticsearch <strong>payload</strong> representation as a raw Python dictionary. However ESEngine comes with <strong>utils.payload</strong> helper module to help you building payloads in a less verbose and Pythonic way.</p>

<h3>
<a id="why-not-elasticsearch_dsl" class="anchor" href="#why-not-elasticsearch_dsl" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why not elasticsearch_dsl?</h3>

<p>ElasticSearch DSL is an excellent tool, a very nice effort by the maintainers of the official ES library, it is handy in most of the cases, but because it is built on top of operator overiding, sometimes leads to a <strong>confuse query building</strong>, sometimes it is better to write raw_queries or use a simpler payload builder having more control and visibility of what os being generated. </p>

<p>ElasticSearch_DSL as a high level abstraction promotes <strong>Think only of Python objects, dont't worry about Elastic queries</strong> while ESengine promotes <strong>Know well the Elastic queries and then write them as Python objects</strong>.</p>

<p>ElasticSearch_DSL is more powerful and more complete, tight more with ES specifications while ESEngine is simpler, lightweight shipping only the basics.</p>

<h3>
<a id="project-stage" class="anchor" href="#project-stage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Project Stage</h3>

<p>It is in beta-Release, working in production, but missing a lot of features, you can help using, testing,, discussing or coding!</p>

<h1>
<a id="getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting started</h1>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>ESengine needs a client to communicate with E.S, you can use one of the following:</p>

<ul>
<li>ElasticSearch-py (official)</li>
<li>Py-Elasticsearch (unofficial)</li>
<li>Create your own implementing the same api-protocol</li>
<li>Use the MockES provided as py.test fixture (only for tests)</li>
</ul>

<p>Because of bulk operations you are recommendded to use
<strong>elasticsearch-py</strong> (Official E.S Python library) so the instalation 
depends on the version of elasticsearch you are using.</p>

<h3>
<a id="in-short" class="anchor" href="#in-short" aria-hidden="true"><span class="octicon octicon-link"></span></a>in short</h3>

<p>Install the client and then install ESEngine</p>

<ul>
<li>for 2.0 + use "elasticsearch&gt;=2.0.0,&lt;3.0.0"</li>
<li>for 1.0 + use "elasticsearch&gt;=1.0.0,&lt;2.0.0"</li>
<li>under 1.0 use "elasticsearch&lt;1.0.0"</li>
</ul>

<p>For the latest use:</p>

<div class="highlight highlight-source-shell"><pre>$ pip install elasticsearch
$ pip install esengine
</pre></div>

<h3>
<a id="or-install-them-together" class="anchor" href="#or-install-them-together" aria-hidden="true"><span class="octicon octicon-link"></span></a>Or install them together</h3>

<h4>
<a id="elasticsearch-2x" class="anchor" href="#elasticsearch-2x" aria-hidden="true"><span class="octicon octicon-link"></span></a>Elasticsearch 2.x</h4>

<div class="highlight highlight-source-shell"><pre>pip install esengine[es2]</pre></div>

<h4>
<a id="elasticsearch-1x" class="anchor" href="#elasticsearch-1x" aria-hidden="true"><span class="octicon octicon-link"></span></a>Elasticsearch 1.x</h4>

<div class="highlight highlight-source-shell"><pre>pip install esengine[es1]</pre></div>

<h4>
<a id="elasticsearch-090x" class="anchor" href="#elasticsearch-090x" aria-hidden="true"><span class="octicon octicon-link"></span></a>Elasticsearch 0.90.x</h4>

<div class="highlight highlight-source-shell"><pre>pip install esengine[es0]</pre></div>

<p>The above command will install esengine and the elasticsearch library specific for you ES version.</p>

<h1>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h1>

<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> elasticsearch <span class="pl-k">import</span> ElasticSearch
<span class="pl-k">from</span> esengine <span class="pl-k">import</span> Document, StringField</pre></div>

<h2>
<a id="defining-a-document" class="anchor" href="#defining-a-document" aria-hidden="true"><span class="octicon octicon-link"></span></a>Defining a document</h2>

<div class="highlight highlight-source-python"><pre><span class="pl-k">class</span> <span class="pl-en">Person</span>(<span class="pl-e">Document</span>):
    <span class="pl-c"># define _meta attributes</span>
    _doctype <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>  <span class="pl-c"># optional, it can be set after using "having" method</span>
    _index <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>universe<span class="pl-pds">"</span></span>  <span class="pl-c"># optional, it can be set after using "having" method</span>
    _es <span class="pl-k">=</span> ElasticSearch(<span class="pl-smi">host</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>host<span class="pl-pds">'</span></span>, <span class="pl-smi">port</span><span class="pl-k">=</span>port)  <span class="pl-c"># optional, it can be explicit passed to methods</span>

    <span class="pl-c"># define fields</span>
    name <span class="pl-k">=</span> StringField()
</pre></div>

<blockquote>
<p>If you do not specify an "id" field, ESEngine will automatically add "id" as StringField. It is recommended that when specifying you use StringField for ids.</p>
</blockquote>

<h2>
<a id="fields" class="anchor" href="#fields" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fields</h2>

<h3>
<a id="base-fields" class="anchor" href="#base-fields" aria-hidden="true"><span class="octicon octicon-link"></span></a>Base Fields</h3>

<div class="highlight highlight-source-python"><pre>name <span class="pl-k">=</span> StringField()
age <span class="pl-k">=</span> IntegerField()
weight <span class="pl-k">=</span> FloatField()
factor <span class="pl-k">=</span> LongField()
active <span class="pl-k">=</span> BooleanField()
birthday <span class="pl-k">=</span> DateField()</pre></div>

<h3>
<a id="special-fields" class="anchor" href="#special-fields" aria-hidden="true"><span class="octicon octicon-link"></span></a>Special Fields</h3>

<h4>
<a id="geopointfield" class="anchor" href="#geopointfield" aria-hidden="true"><span class="octicon octicon-link"></span></a>GeoPointField</h4>

<p>A field to hold GeoPoint with modes dict|array|string and its mappings</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">class</span> <span class="pl-en">Obj</span>(<span class="pl-e">Document</span>):
    location <span class="pl-k">=</span> GeoPointField(<span class="pl-smi">mode</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>dict<span class="pl-pds">'</span></span>)  <span class="pl-c"># default</span>
    <span class="pl-c"># An object representation with lat and lon explicitly named</span>

Obj.init() <span class="pl-c"># important to put the proper mapping for geo location</span>

obj <span class="pl-k">=</span> Obj()

obj.location <span class="pl-k">=</span> {<span class="pl-s"><span class="pl-pds">"</span>lat<span class="pl-pds">"</span></span>: <span class="pl-c1">40.722</span>, <span class="pl-s"><span class="pl-pds">"</span>lon<span class="pl-pds">"</span></span>: <span class="pl-k">-</span><span class="pl-c1">73.989</span>}}

<span class="pl-k">class</span> <span class="pl-en">Obj</span>(<span class="pl-e">Document</span>):
    location <span class="pl-k">=</span> GeoPointField(<span class="pl-smi">mode</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>string<span class="pl-pds">'</span></span>)
    <span class="pl-c"># A string representation, with "lat,lon"</span>

obj.location <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>40.715, -74.011<span class="pl-pds">"</span></span>

<span class="pl-k">class</span> <span class="pl-en">Obj</span>(<span class="pl-e">Document</span>):
    location <span class="pl-k">=</span> GeoPointField(<span class="pl-smi">mode</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>array<span class="pl-pds">'</span></span>)
    <span class="pl-c"># An array representation with [lon,lat].</span>

obj.location <span class="pl-k">=</span> [<span class="pl-k">-</span><span class="pl-c1">73.983</span>, <span class="pl-c1">40.719</span>]</pre></div>

<h4>
<a id="objectfield" class="anchor" href="#objectfield" aria-hidden="true"><span class="octicon octicon-link"></span></a>ObjectField</h4>

<p>A field to hold nested one-dimension objects, schema-less or with properties validation.</p>

<div class="highlight highlight-source-python"><pre><span class="pl-c"># accepts only dictionaries having strct "street" and "number" keys</span>
address <span class="pl-k">=</span> ObjectField(<span class="pl-smi">properties</span><span class="pl-k">=</span>{<span class="pl-s"><span class="pl-pds">"</span>street<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>number<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>})

<span class="pl-c"># Accepts any Python dictionary</span>
extravalues <span class="pl-k">=</span> ObjectField() </pre></div>

<h4>
<a id="arrayfield" class="anchor" href="#arrayfield" aria-hidden="true"><span class="octicon octicon-link"></span></a>ArrayField</h4>

<p>A Field to hold arrays (python lists)</p>

<p>In the base, any field can accept <strong>multi</strong> parameter</p>

<div class="highlight highlight-source-python"><pre>colors <span class="pl-k">=</span> StringField(<span class="pl-smi">multi</span><span class="pl-k">=</span><span class="pl-c1">True</span>)   <span class="pl-c"># accepts ["blue", "green", "yellow", ....]</span></pre></div>

<p>But sometimes (specially for nested objects) it is better to be explicit, and also it generates a better mapping</p>

<div class="highlight highlight-source-python"><pre><span class="pl-c"># accepts an array of strings ["blue", "green", "yellow", ....]</span>
colors <span class="pl-k">=</span> ArrayField(StringField()) </pre></div>

<p>It is available for any other field</p>

<pre><code>locations = ArrayField(GeoPointField())
numbers = ArrayField(IntegerField())
fractions = ArrayField(FloatField())
addresses = ArrayField(ObjectField(properties={"street": "string", "number": "integer"}))
list_of_lists_of_strings = ArrayField(ArrayField(StringField()))
</code></pre>

<h2>
<a id="indexing" class="anchor" href="#indexing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Indexing</h2>

<div class="highlight highlight-source-python"><pre>person <span class="pl-k">=</span> Person(<span class="pl-smi">id</span><span class="pl-k">=</span><span class="pl-c1">1234</span>, <span class="pl-smi">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Gonzo<span class="pl-pds">"</span></span>)
person.save()  <span class="pl-c"># or pass .save(es=es_client_instance) if not specified in model </span></pre></div>

<h2>
<a id="getting-by-id" class="anchor" href="#getting-by-id" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting by id</h2>

<div class="highlight highlight-source-python"><pre>Person.get(<span class="pl-smi">id</span><span class="pl-k">=</span><span class="pl-c1">1234</span>)</pre></div>

<h2>
<a id="filtering-by-ids" class="anchor" href="#filtering-by-ids" aria-hidden="true"><span class="octicon octicon-link"></span></a>filtering by IDS</h2>

<div class="highlight highlight-source-python"><pre>ids <span class="pl-k">=</span> [<span class="pl-c1">1234</span>, <span class="pl-c1">5678</span>, <span class="pl-c1">9101</span>]
power_trio <span class="pl-k">=</span> Person.filter(<span class="pl-smi">ids</span><span class="pl-k">=</span>ids)</pre></div>

<h2>
<a id="filtering-by-fields" class="anchor" href="#filtering-by-fields" aria-hidden="true"><span class="octicon octicon-link"></span></a>filtering by fields</h2>

<div class="highlight highlight-source-python"><pre>Person.filter(<span class="pl-smi">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Gonzo<span class="pl-pds">"</span></span>)</pre></div>

<h2>
<a id="searching" class="anchor" href="#searching" aria-hidden="true"><span class="octicon octicon-link"></span></a>Searching</h2>

<p>ESengine does not try to create abstraction for query building, 
by default ESengine only implements search transport receiving a raw ES query 
in form of a Python dictionary.</p>

<div class="highlight highlight-source-python"><pre>query <span class="pl-k">=</span> {
    <span class="pl-s"><span class="pl-pds">"</span>query<span class="pl-pds">"</span></span>: {
        <span class="pl-s"><span class="pl-pds">"</span>filtered<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>query<span class="pl-pds">"</span></span>: {
                <span class="pl-s"><span class="pl-pds">"</span>match_all<span class="pl-pds">"</span></span>: {}
            },
            <span class="pl-s"><span class="pl-pds">"</span>filter<span class="pl-pds">"</span></span>: {
                <span class="pl-s"><span class="pl-pds">"</span>ids<span class="pl-pds">"</span></span>: {
                    <span class="pl-s"><span class="pl-pds">"</span>values<span class="pl-pds">"</span></span>: [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>]
                }
            }
        }
    }
}
Person.search(query, <span class="pl-smi">size</span><span class="pl-k">=</span><span class="pl-c1">10</span>)</pre></div>

<h2>
<a id="getting-all-documents-match_all" class="anchor" href="#getting-all-documents-match_all" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting all documents (match_all)</h2>

<div class="highlight highlight-source-python"><pre>Person.all()

<span class="pl-c"># with more arguments</span>

Person.all(<span class="pl-smi">size</span><span class="pl-k">=</span><span class="pl-c1">20</span>)
</pre></div>

<h2>
<a id="counting" class="anchor" href="#counting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Counting</h2>

<div class="highlight highlight-source-python"><pre>Person.count(<span class="pl-smi">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>Gonzo<span class="pl-pds">'</span></span>)</pre></div>

<h2>
<a id="updating" class="anchor" href="#updating" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating</h2>

<h3>
<a id="a-single-document" class="anchor" href="#a-single-document" aria-hidden="true"><span class="octicon octicon-link"></span></a>A single document</h3>

<p>A single document can be updated simply using the <strong>.save()</strong> method</p>

<div class="highlight highlight-source-python"><pre>
person <span class="pl-k">=</span> Person.get(<span class="pl-smi">id</span><span class="pl-k">=</span><span class="pl-c1">1234</span>)
person.name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Another Name<span class="pl-pds">"</span></span>
person.save()
</pre></div>

<h3>
<a id="updating-a-resultset" class="anchor" href="#updating-a-resultset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating a Resultset</h3>

<p>The Document methods <strong>.get</strong>, <strong>.filter</strong> and <strong>.search</strong> will return an instance
of <strong>ResultSet</strong> object. This object is an Iterator containing the <strong>hits</strong> reached by 
the filtering or search process and exposes some CRUD methods[ <strong>update</strong>, <strong>delete</strong> and <strong>reload</strong> ]
to deal with its results.</p>

<div class="highlight highlight-source-python"><pre>people <span class="pl-k">=</span> Person.filter(<span class="pl-smi">field</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>)
people.update(<span class="pl-smi">another_field</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>another_value<span class="pl-pds">'</span></span>)</pre></div>

<blockquote>
<p>When updating documents sometimes you need the changes done in the E.S index reflected in the objects 
of the <strong>ResultSet</strong> iterator, so you can use <strong>.reload</strong> method to perform that action.</p>
</blockquote>

<h3>
<a id="the-use-of-reload-method" class="anchor" href="#the-use-of-reload-method" aria-hidden="true"><span class="octicon octicon-link"></span></a>The use of <strong>reload</strong> method</h3>

<div class="highlight highlight-source-python"><pre>people <span class="pl-k">=</span> Person.filter(<span class="pl-smi">field</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>)
<span class="pl-k">print</span> people
... <span class="pl-k">&lt;</span>Resultset: [{<span class="pl-s"><span class="pl-pds">'</span>field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>another_field<span class="pl-pds">'</span></span>: <span class="pl-c1">None</span>}, 
                 {<span class="pl-s"><span class="pl-pds">'</span>field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>another_field<span class="pl-pds">'</span></span>: <span class="pl-c1">None</span>}]<span class="pl-k">&gt;</span>

<span class="pl-c"># Updating another field on both instances</span>
people.update(<span class="pl-smi">another_field</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>another_value<span class="pl-pds">'</span></span>)
<span class="pl-k">print</span> people
... <span class="pl-k">&lt;</span>Resultset: [{<span class="pl-s"><span class="pl-pds">'</span>field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>another_field<span class="pl-pds">'</span></span>: <span class="pl-c1">None</span>}, {<span class="pl-s"><span class="pl-pds">'</span>field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>another_field<span class="pl-pds">'</span></span>: <span class="pl-c1">None</span>}]<span class="pl-k">&gt;</span>

<span class="pl-c"># Note that in E.S index the values weres changed but the current ResultSet is not updated by defaul</span>
<span class="pl-c"># you have to fire an update</span>
people.reload()

<span class="pl-k">print</span> people
... <span class="pl-k">&lt;</span>Resultset: [{<span class="pl-s"><span class="pl-pds">'</span>field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>another_field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>another_value<span class="pl-pds">'</span></span>},
                 {<span class="pl-s"><span class="pl-pds">'</span>field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>another_field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>another_value<span class="pl-pds">'</span></span>}]<span class="pl-k">&gt;</span>

</pre></div>

<h3>
<a id="deleting-documents" class="anchor" href="#deleting-documents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deleting documents</h3>

<h4>
<a id="a-resultset" class="anchor" href="#a-resultset" aria-hidden="true"><span class="octicon octicon-link"></span></a>A ResultSet</h4>

<div class="highlight highlight-source-python"><pre>people <span class="pl-k">=</span> Person.all()
people.delete()</pre></div>

<h4>
<a id="a-single-document-1" class="anchor" href="#a-single-document-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>A single document</h4>

<div class="highlight highlight-source-python"><pre>Person.get(<span class="pl-smi">id</span><span class="pl-k">=</span><span class="pl-c1">123</span>).delete()</pre></div>

<h2>
<a id="bulk-operations" class="anchor" href="#bulk-operations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bulk operations</h2>

<p>ESEngine takes advantage of elasticsearch-py helpers for bulk actions, 
the <strong>ResultSet</strong> object uses <strong>bulk</strong> melhod to <strong>update</strong> and <strong>delete</strong> documents.</p>

<p>But you can use it in a explicit way using Document's <strong>update_all</strong>, <strong>save__all</strong> and <strong>delete_all</strong> methods.</p>

<h4>
<a id="lets-create-a-bunch-of-document-instances" class="anchor" href="#lets-create-a-bunch-of-document-instances" aria-hidden="true"><span class="octicon octicon-link"></span></a>Lets create a bunch of document instances</h4>

<div class="highlight highlight-source-python"><pre>top_5_racing_bikers <span class="pl-k">=</span> []

<span class="pl-k">for</span> name <span class="pl-k">in</span> [<span class="pl-s"><span class="pl-pds">'</span>Eddy Merckx<span class="pl-pds">'</span></span>, 
             <span class="pl-s"><span class="pl-pds">'</span>Bernard Hinault<span class="pl-pds">'</span></span>, 
             <span class="pl-s"><span class="pl-pds">'</span>Jacques Anquetil<span class="pl-pds">'</span></span>, 
             <span class="pl-s"><span class="pl-pds">'</span>Sean Kelly<span class="pl-pds">'</span></span>, 
             <span class="pl-s"><span class="pl-pds">'</span>Lance Armstrong<span class="pl-pds">'</span></span>]:
     top_5_racing_bikers.append(Person(<span class="pl-smi">name</span><span class="pl-k">=</span>name))</pre></div>

<h4>
<a id="save-it-all" class="anchor" href="#save-it-all" aria-hidden="true"><span class="octicon octicon-link"></span></a>Save it all</h4>

<div class="highlight highlight-source-python"><pre>Person.save_all(top_5_racing_bikers)</pre></div>

<h4>
<a id="using-the-create-shortcut" class="anchor" href="#using-the-create-shortcut" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using the <strong>create</strong> shortcut</h4>

<p>The above could be achieved using <strong>create</strong> shortcut</p>

<h5>
<a id="a-single" class="anchor" href="#a-single" aria-hidden="true"><span class="octicon octicon-link"></span></a>A single</h5>

<div class="highlight highlight-source-python"><pre>Person.create(<span class="pl-smi">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>Eddy Merckx<span class="pl-pds">'</span></span>, <span class="pl-smi">active</span><span class="pl-k">=</span><span class="pl-c1">False</span>)</pre></div>

<blockquote>
<p>Create will return the instance of the indexed Document</p>
</blockquote>

<h5>
<a id="all-using-list-comprehension" class="anchor" href="#all-using-list-comprehension" aria-hidden="true"><span class="octicon octicon-link"></span></a>All using list comprehension</h5>

<div class="highlight highlight-source-python"><pre>top_5_racing_bikers <span class="pl-k">=</span> [
    Person.create(<span class="pl-smi">name</span><span class="pl-k">=</span>name, <span class="pl-smi">active</span><span class="pl-k">=</span><span class="pl-c1">False</span>)
    <span class="pl-k">for</span> name <span class="pl-k">in</span> [<span class="pl-s"><span class="pl-pds">'</span>Eddy Merckx<span class="pl-pds">'</span></span>, 
                 <span class="pl-s"><span class="pl-pds">'</span>Bernard Hinault<span class="pl-pds">'</span></span>, 
                 <span class="pl-s"><span class="pl-pds">'</span>Jacques Anquetil<span class="pl-pds">'</span></span>, 
                 <span class="pl-s"><span class="pl-pds">'</span>Sean Kelly<span class="pl-pds">'</span></span>, 
                 <span class="pl-s"><span class="pl-pds">'</span>Lance Armstrong<span class="pl-pds">'</span></span>]
]
</pre></div>

<blockquote>
<p>NOTE: <strong>.create</strong> method will automatically save the document to the index, and
will not raise an error if there is a document with the same ID (if specified), it will update it acting as upsert.</p>
</blockquote>

<h4>
<a id="updating-all" class="anchor" href="#updating-all" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating all</h4>

<p>Turning the field <strong>active</strong> to <strong>True</strong> for all documents</p>

<div class="highlight highlight-source-python"><pre>Person.update_all(top_5_racing_bikes, <span class="pl-smi">active</span><span class="pl-k">=</span><span class="pl-c1">True</span>)</pre></div>

<h4>
<a id="deleting-all" class="anchor" href="#deleting-all" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deleting all</h4>

<div class="highlight highlight-source-python"><pre>Person.delete_all(top_5_racing_bikes)</pre></div>

<h4>
<a id="chunck-size" class="anchor" href="#chunck-size" aria-hidden="true"><span class="octicon octicon-link"></span></a>Chunck size</h4>

<p>chunk_size is number of docs in one chunk sent to ES (default: 500)
you can change using <strong>meta</strong> argument.</p>

<div class="highlight highlight-source-python"><pre>Person.update_all(
    top_5_racing_bikes, <span class="pl-c"># the documents</span>
    <span class="pl-smi">active</span><span class="pl-k">=</span><span class="pl-c1">True</span>,  <span class="pl-c"># values to be changed</span>
    <span class="pl-smi">meta</span><span class="pl-k">=</span>{<span class="pl-s"><span class="pl-pds">'</span>chunk_size<span class="pl-pds">'</span></span>: <span class="pl-c1">200</span>}  <span class="pl-c"># meta data passed to **bulk** operation    </span>
)</pre></div>

<h4>
<a id="utilities" class="anchor" href="#utilities" aria-hidden="true"><span class="octicon octicon-link"></span></a>Utilities</h4>

<h4>
<a id="mapping-and-mapping-migrations" class="anchor" href="#mapping-and-mapping-migrations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mapping and Mapping migrations</h4>

<p>ESEngine does not saves mappings automatically, but it offers an utility to generate and save mappings on demand
You can create a cron job to refresh mappings once a day or run it every time your model changes</p>

<h5>
<a id="using-the-document" class="anchor" href="#using-the-document" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using the document</h5>

<div class="highlight highlight-source-python"><pre><span class="pl-k">class</span> <span class="pl-en">Person</span>(<span class="pl-e">Document</span>):
    <span class="pl-c"># define _meta attributes</span>
    _doctype <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>  <span class="pl-c"># optional, it can be set after using "having" method</span>
    _index <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>universe<span class="pl-pds">"</span></span>  <span class="pl-c"># optional, it can be set after using "having" method</span>
    _es <span class="pl-k">=</span> ElasticSearch(<span class="pl-smi">host</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>host<span class="pl-pds">'</span></span>, <span class="pl-smi">port</span><span class="pl-k">=</span>port)  <span class="pl-c"># optional, it can be explicit passed to methods</span>

    <span class="pl-c"># define fields</span>
    name <span class="pl-k">=</span> StringField()
</pre></div>

<h5>
<a id="you-can-use-init-class-method-to-initializeupdate-mappings-settings-and-analyzers" class="anchor" href="#you-can-use-init-class-method-to-initializeupdate-mappings-settings-and-analyzers" aria-hidden="true"><span class="octicon octicon-link"></span></a>You can use <strong>init</strong> class method to initialize/update mappings, settings and analyzers</h5>

<pre><code>Person.init()  # if not defined in model, pass an **es=es_client** here
</code></pre>

<blockquote>
<p>Include above in your the last line of your model files or cron jobs or migration scripts</p>
</blockquote>

<h4>
<a id="validators" class="anchor" href="#validators" aria-hidden="true"><span class="octicon octicon-link"></span></a>Validators</h4>

<h5>
<a id="field-validator" class="anchor" href="#field-validator" aria-hidden="true"><span class="octicon octicon-link"></span></a>Field Validator</h5>

<p>To validate each field separately you can set a list of validators, each 
validator is a callable receiving field_name and value as arguments and
should return None to be valid. If raise or return the data will be invalidated</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> esengine.exceptions <span class="pl-k">import</span> ValidationError

<span class="pl-k">def</span> <span class="pl-en">category_validator</span>(<span class="pl-smi">field_name</span>, <span class="pl-smi">value</span>):
    <span class="pl-c"># check if value is in valid categories</span>
    <span class="pl-k">if</span> value <span class="pl-k">not</span> <span class="pl-k">in</span> [<span class="pl-s"><span class="pl-pds">"</span>primary<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>secondary<span class="pl-pds">"</span></span>, ...]:
        <span class="pl-k">raise</span> ValidationError(<span class="pl-s"><span class="pl-pds">"</span>Invalid category!!!<span class="pl-pds">"</span></span>)

<span class="pl-k">class</span> <span class="pl-en">Obj</span>(<span class="pl-e">Document</span>):
    category <span class="pl-k">=</span> StringField(<span class="pl-smi">validators</span><span class="pl-k">=</span>[category_validator])

obj <span class="pl-k">=</span> Obj()
obj.category <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>another<span class="pl-pds">"</span></span>
obj.save()
Traceback: ValidationError(....)
</pre></div>

<h5>
<a id="document-validator" class="anchor" href="#document-validator" aria-hidden="true"><span class="octicon octicon-link"></span></a>Document Validator</h5>

<p>To validate the whole document you can set a list of validators, each 
validator is a callable receiving the document instance and
should return None to be valid. If raise or return the data will be invalidated</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> esengine.exceptions <span class="pl-k">import</span> ValidationError

<span class="pl-k">def</span> <span class="pl-en">if_city_state_is_required</span>(<span class="pl-smi">obj</span>):
    <span class="pl-k">if</span> obj.city <span class="pl-k">and</span> <span class="pl-k">not</span> obj.state:
        <span class="pl-k">raise</span> ValidationError(<span class="pl-s"><span class="pl-pds">"</span>If city is defined you should define state<span class="pl-pds">"</span></span>)

<span class="pl-k">class</span> <span class="pl-en">Obj</span>(<span class="pl-e">Document</span>):
    _validators <span class="pl-k">=</span> [if_city_state_is_required]

    city <span class="pl-k">=</span> StringField()
    state <span class="pl-k">=</span> StringField()

obj <span class="pl-k">=</span> Obj()
obj.city <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Sao Paulo<span class="pl-pds">"</span></span>
obj.save()
Traceback: ValidationError(....)
</pre></div>

<h4>
<a id="refreshing" class="anchor" href="#refreshing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Refreshing</h4>

<p>Sometimes you need to force indices-shards refresh for testing, you can use</p>

<div class="highlight highlight-source-python"><pre><span class="pl-c"># Will refresh all indices</span>
Document.refresh()</pre></div>

<h4>
<a id="payload-builder" class="anchor" href="#payload-builder" aria-hidden="true"><span class="octicon octicon-link"></span></a>Payload builder</h4>

<p>Sometimes queries turns in to complex and verbose data structures, to help you
(use with moderation) you can use Payload utils to build queries.</p>

<h6>
<a id="example-using-a-raw-query" class="anchor" href="#example-using-a-raw-query" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example using a raw query:</h6>

<div class="highlight highlight-source-python"><pre>query <span class="pl-k">=</span> {
    <span class="pl-s"><span class="pl-pds">"</span>query<span class="pl-pds">"</span></span>: {
        <span class="pl-s"><span class="pl-pds">"</span>filtered<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>query<span class="pl-pds">"</span></span>: {
                <span class="pl-s"><span class="pl-pds">"</span>match_all<span class="pl-pds">"</span></span>: {}
            },
            <span class="pl-s"><span class="pl-pds">"</span>filter<span class="pl-pds">"</span></span>: {
                <span class="pl-s"><span class="pl-pds">"</span>ids<span class="pl-pds">"</span></span>: {
                    <span class="pl-s"><span class="pl-pds">"</span>values<span class="pl-pds">"</span></span>: [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>]
                }
            }
        }
    }
}

Person.search(<span class="pl-smi">query</span><span class="pl-k">=</span>query, <span class="pl-smi">size</span><span class="pl-k">=</span><span class="pl-c1">10</span>)</pre></div>

<h6>
<a id="same-example-using-payload-utils" class="anchor" href="#same-example-using-payload-utils" aria-hidden="true"><span class="octicon octicon-link"></span></a>Same example using payload utils</h6>

<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> esengine <span class="pl-k">import</span> Payload, Query, Filter
payload <span class="pl-k">=</span> Payload(<span class="pl-smi">query</span><span class="pl-k">=</span>Query.filtered(<span class="pl-smi">query</span><span class="pl-k">=</span>Query.match_all(), <span class="pl-smi">filter</span><span class="pl-k">=</span>Filter.ids([<span class="pl-c1">1</span>, <span class="pl-c1">2</span>])))
Person.search(payload, <span class="pl-smi">size</span><span class="pl-k">=</span><span class="pl-c1">10</span>)</pre></div>

<blockquote>
<p>Payload utils exposes Payload, Query, Filter, Aggregate, Suggesters</p>
</blockquote>

<p>You can also set model on payload initialization to create a more complete payload definition</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> esengine <span class="pl-k">import</span> Payload, Query, Filter
payload <span class="pl-k">=</span> Payload(
    <span class="pl-smi">model</span><span class="pl-k">=</span>Person,
    <span class="pl-smi">query</span><span class="pl-k">=</span>Query.filtered(<span class="pl-smi">query</span><span class="pl-k">=</span>Query.match_all(), <span class="pl-smi">filter</span><span class="pl-k">=</span>Filter.ids([<span class="pl-c1">1</span>, <span class="pl-c1">2</span>]))
    <span class="pl-smi">sort</span><span class="pl-k">=</span>{<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: {<span class="pl-s"><span class="pl-pds">"</span>order<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>desc<span class="pl-pds">"</span></span>}},
    <span class="pl-smi">size</span><span class="pl-k">=</span><span class="pl-c1">10</span>
)
payload.search()</pre></div>

<h6>
<a id="more-examples" class="anchor" href="#more-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>More examples</h6>

<p>You can use Payload, Query or Filter direct in search</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> esengine <span class="pl-k">import</span> Payload, Query, Filter

Person.search(Payload(<span class="pl-smi">query</span><span class="pl-k">=</span>Query.match_all()))

Person.search(Query.bool(<span class="pl-smi">must</span><span class="pl-k">=</span>[Query.match(<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Gonzo<span class="pl-pds">"</span></span>)]))

Person.search(Query.match_all())

Person.search(Filter.ids([<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]))
</pre></div>

<h6>
<a id="chaining" class="anchor" href="#chaining" aria-hidden="true"><span class="octicon octicon-link"></span></a>chaining</h6>

<p>Payload object is chainable so you can do:</p>

<div class="highlight highlight-source-python"><pre>payload <span class="pl-k">=</span> Payload(<span class="pl-smi">query</span><span class="pl-k">=</span>query).size(<span class="pl-c1">10</span>).sort(<span class="pl-s"><span class="pl-pds">"</span>field<span class="pl-pds">"</span></span>, <span class="pl-smi">order</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>desc<span class="pl-pds">"</span></span>)
Document.search(payload) 
<span class="pl-c"># or the equivalent</span>
payload.search(Document)</pre></div>

<h4>
<a id="pagination" class="anchor" href="#pagination" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pagination</h4>

<p>You can paginate a payload, lets say you have indexed 500 documents under 'test' category and now you need to retrieve 50 per page.</p>

<blockquote>
<p>Result will be included in <strong>pagination.items</strong> </p>
</blockquote>

<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> esengine <span class="pl-k">import</span> Payload, Filter
<span class="pl-k">from</span> models <span class="pl-k">import</span> Doc

payload <span class="pl-k">=</span> Payload(Doc, <span class="pl-smi">filter</span><span class="pl-k">=</span>Filter.term(<span class="pl-s"><span class="pl-pds">'</span>category<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>test<span class="pl-pds">'</span></span>))

<span class="pl-c"># Total documents</span>
payload.count()
<span class="pl-c1">500</span>

<span class="pl-c"># Paginate it</span>
current_page <span class="pl-k">=</span> <span class="pl-c1">1</span>  <span class="pl-c"># you have to increase it on each pagination</span>
pagination <span class="pl-k">=</span> payload.paginate(<span class="pl-smi">page</span><span class="pl-k">=</span>current_page, <span class="pl-smi">per_page</span><span class="pl-k">=</span><span class="pl-c1">50</span>)

pagination.total
<span class="pl-c1">500</span>

pagination.pages
<span class="pl-c1">10</span>

pagination.has_prev
<span class="pl-c1">False</span>

pagination.has_next
<span class="pl-c1">True</span>

pagination.next_num
<span class="pl-c1">2</span>

<span class="pl-c1">len</span>(pagination.items)
<span class="pl-c1">50</span>

<span class="pl-k">for</span> item <span class="pl-k">in</span> pagination.items:
    <span class="pl-c"># do something with item</span>

<span class="pl-c"># Turn the page</span>

current_page <span class="pl-k">+=</span> <span class="pl-c1">1</span>
pagination <span class="pl-k">=</span> payload.paginate(<span class="pl-smi">page</span><span class="pl-k">=</span>current_page, <span class="pl-smi">per_page</span><span class="pl-k">=</span><span class="pl-c1">50</span>)
pagination.page
<span class="pl-c1">2</span>
pagination.has_prev
<span class="pl-c1">True</span>

<span class="pl-c"># Another option to move pages</span>

pagination  <span class="pl-k">=</span> pagination.next_page()
pagination.page
<span class="pl-c1">3</span>

pagination <span class="pl-k">=</span> pagination.prev_page()
pagination.page
<span class="pl-c1">2</span>

<span class="pl-c"># Turn the page in place</span>

pagination.backward()
pagination.page
<span class="pl-c1">1</span>

pagination.forward()
pagination.page
<span class="pl-c1">2</span></pre></div>

<h5>
<a id="create-a-paginator-in-jinja-template" class="anchor" href="#create-a-paginator-in-jinja-template" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create a paginator in Jinja template</h5>

<p>So you want to create buttons for pagination in your jinja template</p>

<div class="highlight highlight-text-html-django"><pre><span class="pl-e">{%</span> <span class="pl-s">macro</span> <span class="pl-s">render_pagination</span>(<span class="pl-s">pagination</span>, <span class="pl-s">endpoint</span>) <span class="pl-e">%}</span>
  &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s">pagination</span>&gt;
  <span class="pl-e">{%</span>- <span class="pl-k">for</span> <span class="pl-s">page</span> <span class="pl-k">in</span> <span class="pl-s">pagination</span>.<span class="pl-s">iter_pages</span>() <span class="pl-e">%}</span>
    <span class="pl-e">{%</span> <span class="pl-k">if</span> <span class="pl-s">page</span> <span class="pl-e">%}</span>
      <span class="pl-e">{%</span> <span class="pl-k">if</span> <span class="pl-s">page</span> != <span class="pl-s">pagination</span>.<span class="pl-s">page</span> <span class="pl-e">%}</span>
        &lt;<span class="pl-ent">a</span> <span class="pl-e">href</span>=<span class="pl-s"><span class="pl-pds">"</span>{{ url_for(endpoint, page=page) }}<span class="pl-pds">"</span></span>&gt;{{ page }}&lt;/<span class="pl-ent">a</span>&gt;
      <span class="pl-e">{%</span> <span class="pl-k">else</span> <span class="pl-e">%}</span>
        &lt;<span class="pl-ent">strong</span>&gt;{{ page }}&lt;/<span class="pl-ent">strong</span>&gt;
      <span class="pl-e">{%</span> <span class="pl-k">endif</span> <span class="pl-e">%}</span>
    <span class="pl-e">{%</span> <span class="pl-k">else</span> <span class="pl-e">%}</span>
      &lt;<span class="pl-ent">span</span> <span class="pl-e">class</span>=<span class="pl-s">ellipsis</span>&gt;…&lt;/<span class="pl-ent">span</span>&gt;
    <span class="pl-e">{%</span> <span class="pl-k">endif</span> <span class="pl-e">%}</span>
  <span class="pl-e">{%</span>- <span class="pl-k">endfor</span> <span class="pl-e">%}</span>
  &lt;/<span class="pl-ent">div</span>&gt;
<span class="pl-e">{%</span> <span class="pl-s">endmacro</span> <span class="pl-e">%}</span></pre></div>

<h1>
<a id="contribute" class="anchor" href="#contribute" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contribute</h1>

<p>ESEngine is OpenSource! join us!
<a href="http://smallactsmanifesto.org" title="Small Acts Manifesto"><img src="http://smallactsmanifesto.org/static/images/smallacts-badge-80x15-blue.png" alt="Small Acts Manifesto"></a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/catholabs/esengine">Esengine</a> is maintained by <a href="https://github.com/catholabs">catholabs</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-72359632-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
