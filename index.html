<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Esengine by catholabs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Esengine</h1>
      <h2 class="project-tagline">A basic ODM (Object Document Mapper) for Elasticsearch based on MongoEngine.</h2>
      <a href="https://github.com/catholabs/esengine" class="btn">View on GitHub</a>
      <a href="https://github.com/catholabs/esengine/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/catholabs/esengine/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p><a href="https://pypi.python.org/pypi/esengine"><img src="https://img.shields.io/pypi/v/esengine.svg" alt="PyPI"></a>
<a href="https://pypi.python.org/pypi/esengine"><img src="https://img.shields.io/pypi/pyversions/esengine.svg" alt="versions"></a>
<a href="https://travis-ci.org/catholabs/esengine"><img src="http://img.shields.io/travis/catholabs/esengine.svg" alt="Travis CI"></a>
<a href="https://coveralls.io/r/catholabs/esengine"><img src="http://img.shields.io/coveralls/catholabs/esengine.svg" alt="Coverage Status"></a>
<a href="https://landscape.io/github/catholabs/esengine/master"><img src="https://landscape.io/github/catholabs/esengine/master/landscape.svg?style=flat" alt="Code Health"></a>
<a href="http://smallactsmanifesto.org" title="Small Acts Manifesto"><img src="http://smallactsmanifesto.org/static/images/smallacts-badge-80x15-blue.png" alt="Small Acts Manifesto"></a></p>

<h1>
<a id="esengine---elasticsearch-odm" class="anchor" href="#esengine---elasticsearch-odm" aria-hidden="true"><span class="octicon octicon-link"></span></a>ESEngine - ElasticSearch ODM</h1>

<p align="left">
    <img src="octosearch.gif" alt="EsEngine" width="300">
</p>

<h1>
<a id="what-is-esengine" class="anchor" href="#what-is-esengine" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is esengine?</h1>

<h3>
<a id="object-document-mapper-inspired-by-mongoengine" class="anchor" href="#object-document-mapper-inspired-by-mongoengine" aria-hidden="true"><span class="octicon octicon-link"></span></a>(Object Document Mapper) inspired by MongoEngine</h3>

<p>ESengine is ODM, you map elasticsearch indices in to Python objects, those objects are defined 
using the <strong>Document</strong>, <strong>EmbeddedDocument</strong> and <strong>&lt; type &gt;Field</strong> classes provided by ESEngine.</p>

<h3>
<a id="modeling" class="anchor" href="#modeling" aria-hidden="true"><span class="octicon octicon-link"></span></a>modeling</h3>

<p>Out of the box ESengine takes care only of the Document Modeling, this includes Fields and its types and coercion, data mapping and the generation of the basic CRUD operations (Create, Read, Update, Delete).</p>

<h3>
<a id="communication" class="anchor" href="#communication" aria-hidden="true"><span class="octicon octicon-link"></span></a>Communication</h3>

<p>ESengine does not communicate direct with ElasticSearch, it only creates the basic structure, 
to communicate it relies on an ES client providing the transport methods (index, delete, update etc). </p>

<h3>
<a id="es-client" class="anchor" href="#es-client" aria-hidden="true"><span class="octicon octicon-link"></span></a>ES client</h3>

<p>ESengine does not enforce the use of the official ElasticSearch client,
but you are encouraged to use it because it is well maintained and has the support to <strong>bulk</strong> operations. Bu you are free to use another client or create your own.</p>

<h3>
<a id="querying-the-data" class="anchor" href="#querying-the-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Querying the data</h3>

<p>ESengine does not enforce or encourage you to use a DSL language for queries, out of the box you have to
write the elasticsearch <strong>payload</strong> representation as a raw Python dictionary. However ESEngine comes with a <strong>utils.payload</strong> helper module to help you building payloads in a less verbose way.</p>

<h3>
<a id="why-not-elasticsearch_dsl" class="anchor" href="#why-not-elasticsearch_dsl" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why not elasticsearch_dsl?</h3>

<p>ElasticSearch DSL is an excellent tool, a very nice effort by the maintainers of the official ES library, it is handy in most of the cases, but its DSL objects leads to a confuse query building, sometimes it is better to write raw_queries or use a simpler payload builder having more control and visibility of what os being generated. DSL enforce you to use the official ES client and there are cases when a different client implementation perform better or you need to run tests using a Mock. Also, to make things really easy, all the synrax sugar in DSL can lead in to performance problems.</p>

<h3>
<a id="project-stage" class="anchor" href="#project-stage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Project Stage</h3>

<p>It is in beta-Release, working in production, but missing a lot of features, you can help using, testing,, discussing or coding!</p>

<h1>
<a id="getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting started</h1>

<h2>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span class="octicon octicon-link"></span></a>install</h2>

<p>ESengine needs a client to communicate with E.S, you can use one of the following:</p>

<ul>
<li>ElasticSearch-py (official)</li>
<li>Py-Elasticsearch (unofficial)</li>
<li>Create your own implementing the same api-protocol</li>
<li>Use the MockES provided as py.test fixture (only for tests)</li>
</ul>

<p>Because of bulk operations you are recommendded to use
<strong>elasticsearch-py</strong> (Official E.S Python library) so the instalation 
depends on the version of elasticsearch you are using.</p>

<h3>
<a id="elasticsearch-2x" class="anchor" href="#elasticsearch-2x" aria-hidden="true"><span class="octicon octicon-link"></span></a>Elasticsearch 2.x</h3>

<div class="highlight highlight-source-shell"><pre>pip install esengine[es2]</pre></div>

<h3>
<a id="elasticsearch-1x" class="anchor" href="#elasticsearch-1x" aria-hidden="true"><span class="octicon octicon-link"></span></a>Elasticsearch 1.x</h3>

<div class="highlight highlight-source-shell"><pre>pip install esengine[es1]</pre></div>

<h3>
<a id="elasticsearch-090x" class="anchor" href="#elasticsearch-090x" aria-hidden="true"><span class="octicon octicon-link"></span></a>Elasticsearch 0.90.x</h3>

<div class="highlight highlight-source-shell"><pre>pip install esengine[es0]</pre></div>

<p>The above command will install esengine and the elasticsearch library specific for you ES version.</p>

<blockquote>
<p>Alternatively you can only install elasticsearch library before esengine</p>
</blockquote>

<p>pip install <code>&lt;version-specific-es&gt;</code> </p>

<ul>
<li>for 2.0 + use "elasticsearch&gt;=2.0.0,&lt;3.0.0"</li>
<li>for 1.0 + use "elasticsearch&gt;=1.0.0,&lt;2.0.0"</li>
<li>under 1.0 use "elasticsearch&lt;1.0.0"</li>
</ul>

<p>Then install esengine</p>

<div class="highlight highlight-source-shell"><pre>pip install esengine</pre></div>

<h1>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h1>

<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> elasticsearch <span class="pl-k">import</span> ElasticSearch
<span class="pl-k">from</span> esengine <span class="pl-k">import</span> Document, StringField

es <span class="pl-k">=</span> ElasticSearch(<span class="pl-smi">host</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>host<span class="pl-pds">'</span></span>, <span class="pl-smi">port</span><span class="pl-k">=</span>port)</pre></div>

<h2>
<a id="defining-a-document" class="anchor" href="#defining-a-document" aria-hidden="true"><span class="octicon octicon-link"></span></a>Defining a document</h2>

<div class="highlight highlight-source-python"><pre><span class="pl-k">class</span> <span class="pl-en">Person</span>(<span class="pl-e">Document</span>):
    _doctype <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>
    _index <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>universe<span class="pl-pds">"</span></span>

    name <span class="pl-k">=</span> StringField()
</pre></div>

<blockquote>
<p>If you do not specify an "id" field, ESEngine will automatically add "id" as StringField. It is recommended that when specifying you use StringField for ids.</p>
</blockquote>

<h2>
<a id="indexing" class="anchor" href="#indexing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Indexing</h2>

<div class="highlight highlight-source-python"><pre>person <span class="pl-k">=</span> Person(<span class="pl-smi">id</span><span class="pl-k">=</span><span class="pl-c1">1234</span>, <span class="pl-smi">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Gonzo<span class="pl-pds">"</span></span>)
person.save(<span class="pl-smi">es</span><span class="pl-k">=</span>es)</pre></div>

<h2>
<a id="getting-by-id" class="anchor" href="#getting-by-id" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting by id</h2>

<div class="highlight highlight-source-python"><pre>Person.get(<span class="pl-smi">id</span><span class="pl-k">=</span><span class="pl-c1">1234</span>, <span class="pl-smi">es</span><span class="pl-k">=</span>es)</pre></div>

<h2>
<a id="filtering-by-ids" class="anchor" href="#filtering-by-ids" aria-hidden="true"><span class="octicon octicon-link"></span></a>filtering by IDS</h2>

<div class="highlight highlight-source-python"><pre>ids <span class="pl-k">=</span> [<span class="pl-c1">1234</span>, <span class="pl-c1">5678</span>, <span class="pl-c1">9101</span>]
power_trio <span class="pl-k">=</span> Person.filter(<span class="pl-smi">ids</span><span class="pl-k">=</span>ids)</pre></div>

<h2>
<a id="filtering-by-fields" class="anchor" href="#filtering-by-fields" aria-hidden="true"><span class="octicon octicon-link"></span></a>filtering by fields</h2>

<div class="highlight highlight-source-python"><pre>Person.filter(<span class="pl-smi">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Gonzo<span class="pl-pds">"</span></span>, <span class="pl-smi">es</span><span class="pl-k">=</span>es)</pre></div>

<h2>
<a id="searching" class="anchor" href="#searching" aria-hidden="true"><span class="octicon octicon-link"></span></a>Searching</h2>

<p>ESengine does not try to create abstraction for query building, 
by default ESengine only implements search transport receiving a raw ES query 
in form of a Python dictionary.</p>

<div class="highlight highlight-source-python"><pre>query <span class="pl-k">=</span> {
    <span class="pl-s"><span class="pl-pds">"</span>query<span class="pl-pds">"</span></span>: {
        <span class="pl-s"><span class="pl-pds">"</span>filtered<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>query<span class="pl-pds">"</span></span>: {
                <span class="pl-s"><span class="pl-pds">"</span>match_all<span class="pl-pds">"</span></span>: {}
            },
            <span class="pl-s"><span class="pl-pds">"</span>filter<span class="pl-pds">"</span></span>: {
                <span class="pl-s"><span class="pl-pds">"</span>ids<span class="pl-pds">"</span></span>: {
                    <span class="pl-s"><span class="pl-pds">"</span>values<span class="pl-pds">"</span></span>: [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>]
                }
            }
        }
    }
}
Person.search(query, <span class="pl-smi">size</span><span class="pl-k">=</span><span class="pl-c1">10</span>, <span class="pl-smi">es</span><span class="pl-k">=</span>es)</pre></div>

<h2>
<a id="getting-all-documents" class="anchor" href="#getting-all-documents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting all documents</h2>

<div class="highlight highlight-source-python"><pre>Person.all(<span class="pl-smi">es</span><span class="pl-k">=</span>es)

<span class="pl-c"># with more arguments</span>

Person.all(<span class="pl-smi">size</span><span class="pl-k">=</span><span class="pl-c1">20</span>, <span class="pl-smi">es</span><span class="pl-k">=</span>es)
</pre></div>

<h2>
<a id="counting" class="anchor" href="#counting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Counting</h2>

<div class="highlight highlight-source-python"><pre>Person.count(<span class="pl-smi">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>Gonzo<span class="pl-pds">'</span></span>, <span class="pl-smi">es</span><span class="pl-k">=</span>es)</pre></div>

<h2>
<a id="using-a-default-connection" class="anchor" href="#using-a-default-connection" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using a default connection</h2>

<p>By default ES engine does not try to implicit create a connection for you, so you have to pass in <strong>es=es</strong> argument.</p>

<p>You can easily achieve this overwriting the <strong>get_es</strong> method and returning a 
default connection or using any kind of technique as RoundRobin or Mocking for tests
Also you can set the <strong>_es</strong> attribute pointing to a function generating the connection client
or the client instance as the following example:</p>

<div class="highlight highlight-source-python"><pre>
<span class="pl-k">from</span> elasticsearch <span class="pl-k">import</span> ElasticSearch
<span class="pl-k">from</span> esengine <span class="pl-k">import</span> Document, StringField
<span class="pl-k">from</span> esengine.utils <span class="pl-k">import</span> validate_client


<span class="pl-k">class</span> <span class="pl-en">Person</span>(<span class="pl-e">Document</span>):
    _doctype <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>
    _index <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>universe<span class="pl-pds">"</span></span>
    _es <span class="pl-k">=</span> Elasticsearch(<span class="pl-smi">host</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>10.0.0.0<span class="pl-pds">'</span></span>)

    name <span class="pl-k">=</span> StringField()
</pre></div>

<h3>
<a id="now-you-can-use-the-document-transport-methods-ommiting-es-instance" class="anchor" href="#now-you-can-use-the-document-transport-methods-ommiting-es-instance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Now you can use the document transport methods ommiting ES instance</h3>

<div class="highlight highlight-source-python"><pre>person <span class="pl-k">=</span> Person(<span class="pl-smi">id</span><span class="pl-k">=</span><span class="pl-c1">1234</span>, <span class="pl-smi">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Gonzo<span class="pl-pds">"</span></span>)
person.save()

Person.get(<span class="pl-smi">id</span><span class="pl-k">=</span><span class="pl-c1">1234</span>)

Person.filter(<span class="pl-smi">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Gonzo<span class="pl-pds">"</span></span>)</pre></div>

<h2>
<a id="updating" class="anchor" href="#updating" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating</h2>

<h3>
<a id="a-single-document" class="anchor" href="#a-single-document" aria-hidden="true"><span class="octicon octicon-link"></span></a>A single document</h3>

<p>A single document can be updated simply using the <strong>.save()</strong> method</p>

<div class="highlight highlight-source-python"><pre>
person <span class="pl-k">=</span> Person.get(<span class="pl-smi">id</span><span class="pl-k">=</span><span class="pl-c1">1234</span>)
person.name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Another Name<span class="pl-pds">"</span></span>
person.save()
</pre></div>

<h3>
<a id="updating-a-resultset" class="anchor" href="#updating-a-resultset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating a Resultset</h3>

<p>The Document methods <strong>.get</strong>, <strong>.filter</strong> and <strong>.search</strong> will return an instance
of <strong>ResultSet</strong> object. This object is an Iterator containing the <strong>hits</strong> reached by 
the filtering or search process and exposes some CRUD methods[ <strong>update</strong>, <strong>delete</strong> and <strong>reload</strong> ]
to deal with its results.</p>

<div class="highlight highlight-source-python"><pre>people <span class="pl-k">=</span> Person.filter(<span class="pl-smi">field</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>)
people.update(<span class="pl-smi">another_field</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>another_value<span class="pl-pds">'</span></span>)</pre></div>

<blockquote>
<p>When updating documents sometimes you need the changes done in the E.S index reflected in the objects 
of the <strong>ResultSet</strong> iterator, so you can use <strong>.reload</strong> method to perform that action.</p>
</blockquote>

<h3>
<a id="the-use-of-reload-method" class="anchor" href="#the-use-of-reload-method" aria-hidden="true"><span class="octicon octicon-link"></span></a>The use of <strong>reload</strong> method</h3>

<div class="highlight highlight-source-python"><pre>people <span class="pl-k">=</span> Person.filter(<span class="pl-smi">field</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>)
<span class="pl-k">print</span> people
... <span class="pl-k">&lt;</span>Resultset: [{<span class="pl-s"><span class="pl-pds">'</span>field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>another_field<span class="pl-pds">'</span></span>: <span class="pl-c1">None</span>}, 
                 {<span class="pl-s"><span class="pl-pds">'</span>field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>another_field<span class="pl-pds">'</span></span>: <span class="pl-c1">None</span>}]<span class="pl-k">&gt;</span>

<span class="pl-c"># Updating another field on both instances</span>
people.update(<span class="pl-smi">another_field</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>another_value<span class="pl-pds">'</span></span>)
<span class="pl-k">print</span> people
... <span class="pl-k">&lt;</span>Resultset: [{<span class="pl-s"><span class="pl-pds">'</span>field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>another_field<span class="pl-pds">'</span></span>: <span class="pl-c1">None</span>}, {<span class="pl-s"><span class="pl-pds">'</span>field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>another_field<span class="pl-pds">'</span></span>: <span class="pl-c1">None</span>}]<span class="pl-k">&gt;</span>

<span class="pl-c"># Note that in E.S index the values weres changed but the current ResultSet is not updated by defaul</span>
<span class="pl-c"># you have to fire an update</span>
people.reload()

<span class="pl-k">print</span> people
... <span class="pl-k">&lt;</span>Resultset: [{<span class="pl-s"><span class="pl-pds">'</span>field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>another_field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>another_value<span class="pl-pds">'</span></span>},
                 {<span class="pl-s"><span class="pl-pds">'</span>field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>another_field<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>another_value<span class="pl-pds">'</span></span>}]<span class="pl-k">&gt;</span>

</pre></div>

<h3>
<a id="deleting-documents" class="anchor" href="#deleting-documents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deleting documents</h3>

<h4>
<a id="a-resultset" class="anchor" href="#a-resultset" aria-hidden="true"><span class="octicon octicon-link"></span></a>A ResultSet</h4>

<div class="highlight highlight-source-python"><pre>people <span class="pl-k">=</span> Person.all()
people.delete()</pre></div>

<h4>
<a id="a-single-document-1" class="anchor" href="#a-single-document-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>A single document</h4>

<div class="highlight highlight-source-python"><pre>Person.get(<span class="pl-smi">id</span><span class="pl-k">=</span><span class="pl-c1">123</span>).delete()</pre></div>

<h2>
<a id="bulk-operations" class="anchor" href="#bulk-operations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bulk operations</h2>

<p>ESEngine takes advantage of elasticsearch-py helpers for bulk actions, 
the <strong>ResultSet</strong> object uses <strong>bulk</strong> melhod to <strong>update</strong> and <strong>delete</strong> documents.</p>

<p>But you can use it in a explicit way using Document's <strong>update_all</strong>, <strong>save__all</strong> and <strong>delete_all</strong> methods.</p>

<h4>
<a id="lets-create-a-bunch-of-document-instances" class="anchor" href="#lets-create-a-bunch-of-document-instances" aria-hidden="true"><span class="octicon octicon-link"></span></a>Lets create a bunch of document instances</h4>

<div class="highlight highlight-source-python"><pre>top_5_racing_bikers <span class="pl-k">=</span> []

<span class="pl-k">for</span> name <span class="pl-k">in</span> [<span class="pl-s"><span class="pl-pds">'</span>Eddy Merckx<span class="pl-pds">'</span></span>, 
             <span class="pl-s"><span class="pl-pds">'</span>Bernard Hinault<span class="pl-pds">'</span></span>, 
             <span class="pl-s"><span class="pl-pds">'</span>Jacques Anquetil<span class="pl-pds">'</span></span>, 
             <span class="pl-s"><span class="pl-pds">'</span>Sean Kelly<span class="pl-pds">'</span></span>, 
             <span class="pl-s"><span class="pl-pds">'</span>Lance Armstrong<span class="pl-pds">'</span></span>]:
     top_5_racing_bikers.append(Person(<span class="pl-smi">name</span><span class="pl-k">=</span>name))</pre></div>

<h4>
<a id="save-it-all" class="anchor" href="#save-it-all" aria-hidden="true"><span class="octicon octicon-link"></span></a>Save it all</h4>

<div class="highlight highlight-source-python"><pre>Person.save_all(top_5_racing_bikers)</pre></div>

<h4>
<a id="using-the-create-shortcut" class="anchor" href="#using-the-create-shortcut" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using the <strong>create</strong> shortcut</h4>

<p>The above could be achieved using <strong>create</strong> shortcut</p>

<h5>
<a id="a-single" class="anchor" href="#a-single" aria-hidden="true"><span class="octicon octicon-link"></span></a>A single</h5>

<div class="highlight highlight-source-python"><pre>Person.create(<span class="pl-smi">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>Eddy Merckx<span class="pl-pds">'</span></span>, <span class="pl-smi">active</span><span class="pl-k">=</span><span class="pl-c1">False</span>)</pre></div>

<blockquote>
<p>Create will return the instance of the indexed Document</p>
</blockquote>

<h5>
<a id="all-using-list-comprehension" class="anchor" href="#all-using-list-comprehension" aria-hidden="true"><span class="octicon octicon-link"></span></a>All using list comprehension</h5>

<div class="highlight highlight-source-python"><pre>top_5_racing_bikers <span class="pl-k">=</span> [
    Person.create(<span class="pl-smi">name</span><span class="pl-k">=</span>name, <span class="pl-smi">active</span><span class="pl-k">=</span><span class="pl-c1">False</span>)
    <span class="pl-k">for</span> name <span class="pl-k">in</span> [<span class="pl-s"><span class="pl-pds">'</span>Eddy Merckx<span class="pl-pds">'</span></span>, 
                 <span class="pl-s"><span class="pl-pds">'</span>Bernard Hinault<span class="pl-pds">'</span></span>, 
                 <span class="pl-s"><span class="pl-pds">'</span>Jacques Anquetil<span class="pl-pds">'</span></span>, 
                 <span class="pl-s"><span class="pl-pds">'</span>Sean Kelly<span class="pl-pds">'</span></span>, 
                 <span class="pl-s"><span class="pl-pds">'</span>Lance Armstrong<span class="pl-pds">'</span></span>]
]
</pre></div>

<blockquote>
<p>NOTE: <strong>.create</strong> method will automatically save the document to the index, and
will not raise an error if there is a document with the same ID (if specified), it will update it acting as upsert.</p>
</blockquote>

<h4>
<a id="updating-all" class="anchor" href="#updating-all" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating all</h4>

<p>Turning the field <strong>active</strong> to <strong>True</strong> for all documents</p>

<div class="highlight highlight-source-python"><pre>Person.update_all(top_5_racing_bikes, <span class="pl-smi">active</span><span class="pl-k">=</span><span class="pl-c1">True</span>)</pre></div>

<h4>
<a id="deleting-all" class="anchor" href="#deleting-all" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deleting all</h4>

<div class="highlight highlight-source-python"><pre>Person.delete_all(top_5_racing_bikes)</pre></div>

<h4>
<a id="chunck-size" class="anchor" href="#chunck-size" aria-hidden="true"><span class="octicon octicon-link"></span></a>Chunck size</h4>

<p>chunk_size is number of docs in one chunk sent to ES (default: 500)
you can change using <strong>meta</strong> argument.</p>

<div class="highlight highlight-source-python"><pre>Person.update_all(
    top_5_racing_bikes, <span class="pl-c"># the documents</span>
    <span class="pl-smi">active</span><span class="pl-k">=</span><span class="pl-c1">True</span>,  <span class="pl-c"># values to be changed</span>
    <span class="pl-smi">metal</span><span class="pl-k">=</span>{<span class="pl-s"><span class="pl-pds">'</span>chunk_size<span class="pl-pds">'</span></span>: <span class="pl-c1">200</span>}  <span class="pl-c"># meta data passed to **bulk** operation    </span>
)</pre></div>

<h4>
<a id="utilities" class="anchor" href="#utilities" aria-hidden="true"><span class="octicon octicon-link"></span></a>Utilities</h4>

<h4>
<a id="mapping" class="anchor" href="#mapping" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mapping</h4>

<p>TODO:</p>

<h4>
<a id="refreshing" class="anchor" href="#refreshing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Refreshing</h4>

<p>Sometimes you need to force indices-shards refresh for testing, you can use</p>

<div class="highlight highlight-source-python"><pre><span class="pl-c"># Will refresh all indices</span>
Document.refresh()</pre></div>

<h1>
<a id="payload-builder" class="anchor" href="#payload-builder" aria-hidden="true"><span class="octicon octicon-link"></span></a>Payload builder</h1>

<p>Sometimes queries turns in to complex and verbose data structures, to help you
(use with moderation) you can use Payload utils to build queries.</p>

<h2>
<a id="example-using-a-raw-query" class="anchor" href="#example-using-a-raw-query" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example using a raw query:</h2>

<div class="highlight highlight-source-python"><pre>query <span class="pl-k">=</span> {
    <span class="pl-s"><span class="pl-pds">"</span>query<span class="pl-pds">"</span></span>: {
        <span class="pl-s"><span class="pl-pds">"</span>filtered<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>query<span class="pl-pds">"</span></span>: {
                <span class="pl-s"><span class="pl-pds">"</span>match_all<span class="pl-pds">"</span></span>: {}
            },
            <span class="pl-s"><span class="pl-pds">"</span>filter<span class="pl-pds">"</span></span>: {
                <span class="pl-s"><span class="pl-pds">"</span>ids<span class="pl-pds">"</span></span>: {
                    <span class="pl-s"><span class="pl-pds">"</span>values<span class="pl-pds">"</span></span>: [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>]
                }
            }
        }
    }
}

Person.search(<span class="pl-smi">query</span><span class="pl-k">=</span>query, <span class="pl-smi">size</span><span class="pl-k">=</span><span class="pl-c1">10</span>)</pre></div>

<h2>
<a id="same-example-using-payload-utils" class="anchor" href="#same-example-using-payload-utils" aria-hidden="true"><span class="octicon octicon-link"></span></a>Same example using payload utils</h2>

<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> esengine.utils.payload <span class="pl-k">import</span> Payload, Query, Filter
payload <span class="pl-k">=</span> Payload(
    <span class="pl-smi">query</span><span class="pl-k">=</span>Query.filtered(<span class="pl-smi">query</span><span class="pl-k">=</span>Query.match_all(), <span class="pl-smi">filter</span><span class="pl-k">=</span>Filter.ids([<span class="pl-c1">1</span>, <span class="pl-c1">2</span>]))
)
Person.search(<span class="pl-smi">query</span><span class="pl-k">=</span>payload.dict, <span class="pl-smi">size</span><span class="pl-k">=</span><span class="pl-c1">10</span>)</pre></div>

<blockquote>
<p>Payload utils exposes Payload, Query, Filter, Aggregate, Suggesters</p>
</blockquote>

<h1>
<a id="contribute" class="anchor" href="#contribute" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contribute</h1>

<p>ESEngine is OpenSource! join us!</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/catholabs/esengine">Esengine</a> is maintained by <a href="https://github.com/catholabs">catholabs</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
